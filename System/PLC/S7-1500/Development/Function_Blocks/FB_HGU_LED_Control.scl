FUNCTION_BLOCK "FB_HGU_LED_Control"
{ S7_Optimized_Access := 'TRUE' }
VERSION : 1.0
// =============================================================================
// TUSAŞ HGU Control System - LED Control Function Block
// TIA Portal S7-1500 Structured Control Language (SCL)
// Generated: 2025-01-14
// Description: LED control logic based on motor status and filter conditions
// =============================================================================
   VAR_INPUT 
      motor_status : USINT;   // Motor Status (0=Offline, 1=Ready, 2=Running, 3=Warning, 4=Error)
      line_filter_status : USINT;   // Line Filter Status (0=Error, 1=Warning, 2=OK)
      suction_filter_status : USINT;   // Suction Filter Status (0=Error, 1=OK)
      valve_status : USINT;   // Valve Status (0=Closed, 1=Open)
      blink_clock : USINT;   // System blink clock (0=Off, 1=On for running indication)
   END_VAR

   VAR_OUTPUT 
      ready_led : Bool;   // Ready LED (Green)
      warning_led : Bool;   // Warning LED (Yellow)
      error_led : Bool;   // Error LED (Red)
      running_blink : Bool;   // Running Blink LED (Green Blinking)
      line_filter_led_green : Bool;   // Line Filter OK LED (Green)
      line_filter_led_yellow : Bool;   // Line Filter Warning LED (Yellow)
      line_filter_led_red : Bool;   // Line Filter Error LED (Red)
      suction_filter_led_green : Bool;   // Suction Filter OK LED (Green)
      suction_filter_led_red : Bool;   // Suction Filter Error LED (Red)
      valve_led : Bool;   // Valve LED (Green when Open)
   END_VAR


BEGIN
	// =============================================================================
	// Motor Status LED Control Logic
	// Based on execution_variables.txt specifications:
	// 0=Offline(tüm ledler gri), 1=Ready(yeşil led,diğerleri gri), 
	// 2=Running(yeşil blink,diğerleri gri), 3=Warning(sarı,diğerleri gri), 
	// 4=Error(kırmızı,diğerleri gri)
	// =============================================================================
	
	// Initialize all motor status LEDs to OFF (Gray)
	#ready_led := FALSE;
	#warning_led := FALSE;
	#error_led := FALSE;
	#running_blink := FALSE;
	
	// Motor Status LED Logic
	CASE #motor_status OF
	    0: // Offline - All LEDs Gray (OFF)
	        #ready_led := FALSE;
	        #warning_led := FALSE;
	        #error_led := FALSE;
	        #running_blink := FALSE;
	        
	    1: // Ready - Green LED ON, others Gray
	        #ready_led := TRUE;
	        #warning_led := FALSE;
	        #error_led := FALSE;
	        #running_blink := FALSE;
	        
	    2: // Running - Green LED Blinking, others Gray
	        #ready_led := FALSE;
	        #warning_led := FALSE;
	        #error_led := FALSE;
	        #running_blink := (#blink_clock = 1);
	        
	    3: // Warning - Yellow LED ON, others Gray
	        #ready_led := FALSE;
	        #warning_led := TRUE;
	        #error_led := FALSE;
	        #running_blink := FALSE;
	        
	    4: // Error - Red LED ON, others Gray
	        #ready_led := FALSE;
	        #warning_led := FALSE;
	        #error_led := TRUE;
	        #running_blink := FALSE;
	        
	    ELSE: // Default case - All LEDs OFF
	        #ready_led := FALSE;
	        #warning_led := FALSE;
	        #error_led := FALSE;
	        #running_blink := FALSE;
	END_CASE;
	
	// =============================================================================
	// Line Filter LED Control Logic
	// 0=Error(led=kırmızı), 1=Warning(led sarı), 2=OK(led yeşil)
	// =============================================================================
	
	// Initialize all line filter LEDs to OFF
	#line_filter_led_green := FALSE;
	#line_filter_led_yellow := FALSE;
	#line_filter_led_red := FALSE;
	
	CASE #line_filter_status OF
	    0: // Error - Red LED ON
	        #line_filter_led_red := TRUE;
	        
	    1: // Warning - Yellow LED ON
	        #line_filter_led_yellow := TRUE;
	        
	    2: // OK - Green LED ON
	        #line_filter_led_green := TRUE;
	        
	    ELSE:
	        ; // Default case - All LEDs OFF
	        // LEDs remain OFF (already initialized to FALSE)
	END_CASE;
	
	// =============================================================================
	// Suction Filter LED Control Logic
	// 0=Error(led kırmızı), 1=OK(led yeşil)
	// =============================================================================
	
	// Initialize all suction filter LEDs to OFF
	#suction_filter_led_green := FALSE;
	#suction_filter_led_red := FALSE;
	
	CASE #suction_filter_status OF
	    0: // Error - Red LED ON
	        #suction_filter_led_red := TRUE;
	        
	    1: // OK - Green LED ON
	        #suction_filter_led_green := TRUE;
	        
	    ELSE:
	        ; // Default case - All LEDs OFF
	        // LEDs remain OFF (already initialized to FALSE)
	END_CASE;
	
	// =============================================================================
	// Valve LED Control Logic
	// 0=Closed (LED OFF), 1=Open (LED Green)
	// =============================================================================
	
	#valve_led := (#valve_status = 1);
	
END_FUNCTION_BLOCK